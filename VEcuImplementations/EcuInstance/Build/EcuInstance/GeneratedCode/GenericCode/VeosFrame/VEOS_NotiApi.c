/************************************************************************************************************************************************************************\
 *** VEOS_NotiApi.c
 *** 
 *** Implementation of the VEOS Frame NotificationApi.
 *** 
 *** File generated on 2022-02-16
 *** 
 *** Generated by VEOS Frame API generator
 *** 
 *** VEOS Frame build revision          : 5.4.0.1269
 *** VEOS Frame interaction ABI version : 5.4.0.0
 *** GeneratorVersion                   : 5.4.0.0
 *** GeneratorTimeStamp                 : 2022-02-16 10:07:28 (UTC)
 *** ABI NotificationApi                : 5.0.0.0
 *** 
 *** Copyright (c) 2022 by dSPACE GmbH, Paderborn, Germany.
 *** All Rights Reserved.
\************************************************************************************************************************************************************************/

#ifndef VEOS_NOTIAPI_C
#define VEOS_NOTIAPI_C

/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  DEFINES (OPT)
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** Constant pre-processor defines for VEOS frame NotificationApi
\************************************************************************************************************************************************************************/

#ifndef VEOS_NOTIAPI_UNSETFUNCTIONPOINTER
/* The value if no pointer is set. */
#define VEOS_NOTIAPI_UNSETFUNCTIONPOINTER 0
#endif

/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  INCLUDES
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

#include "VEOS.h"
#include "VEOS_Private.h"
#include "VEOS_Callbacks.h"

#include "string.h"


/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  DEFINES
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** Pre-processor defines for API NotiApi to take care of.
\************************************************************************************************************************************************************************/

#ifndef VEOS_NOTIAPI_NOTIFICATION_CFG_VALUE
/* VEOS_NOTIAPI_NOTIFICATION_CFG_VALUE must be defined for a proper functionality of this API. */
#error Required definition of 'VEOS_NOTIAPI_NOTIFICATION_CFG_VALUE' not found. The configuration is invalid.
#endif

/************************************************************************************************************************************************************************\
 *** Constant pre-processor defines for VEOS frame NotificationApi
\************************************************************************************************************************************************************************/

#ifndef VEOS_NOTIAPI_NOTIFICATION
/* Configuration value indicating, whether notifications are enabled or not. */
#define VEOS_NOTIAPI_NOTIFICATION VEOS_NOTIAPI_NOTIFICATION_CFG_VALUE
#endif

/* The API name. */
#ifdef VEOS_API_NAME
#undef VEOS_API_NAME
#endif
#define VEOS_API_NAME "NotificationApi"

/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  VARIABLE DEFINITIONS
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** Directly transferred global variables for VEOS frame NotificationApi
\************************************************************************************************************************************************************************/
/* Pointer to the NotiApi instance. */
void * gp_VEOS_NotiApi_Instance;


/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  FUNCTION DEFINITIONS
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** State management functions for the VEOS frame NotificationApi
\************************************************************************************************************************************************************************/

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_NotiApi_Start
 *** 
 *** DESCRIPTION:
 ***     Performs a start-up on the VEOS Frame NotiApi part.
 *** 
 *** PARAMETERS:
 ***     -/-
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
VEOS_ApiSuccessType VEOS_NotiApi_Start(void)
{
    VEOS_ApiSuccessType result = VEOS_E_OK;

    /* Check if API is correctly connected to the VpuHost */
    #if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
    if (VEOS_NOTIAPI_UNSETFUNCTIONPOINTER == gp_VEOS_NotiApi_CreateNotification)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    #if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
    if (VEOS_NOTIAPI_UNSETFUNCTIONPOINTER == gp_VEOS_NotiApi_StartNotification)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    #if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
    if (VEOS_NOTIAPI_UNSETFUNCTIONPOINTER == gp_VEOS_NotiApi_CancelNotification)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    result = VEOS_E_OK;

    /* Nothing more to do. */
    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, result);

    return result;
}

/************************************************************************************************************************************************************************\
 *** Host function wrappers: Callbacks to simulator backplane
\************************************************************************************************************************************************************************/

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_NotiApi_CreateNotification
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: Creates an asynchronous notification using the specified function to call.
 *** 
 *** PARAMETERS:
 ***     Type                                             Name               Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_SimApi_InterruptCallbackFunctionType  pNotificationFct   Incoming argument: The pointer to the function to call.
 ***     const VEOS_char *                                pNotificationName  Incoming argument: The name of the notification function to call.
 ***     VEOS_uint32 *                                    pNotificationId    Outgoing argument: The id.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
VEOS_ApiSuccessType VEOS_NotiApi_CreateNotification(
    VEOS_SimApi_InterruptCallbackFunctionType const pNotificationFct,
    const VEOS_char * pNotificationName,
    VEOS_uint32 * pNotificationId)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    #ifndef VEOS_NOCHECKS
    /* Check pNotificationFct to be a valid pointer. */
    VEOS_CHECK_PARAM_PTR(pNotificationFct);
    /* Check pNotificationId to be a valid pointer. */
    VEOS_CHECK_PARAM_PTR(pNotificationId);
    #endif

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_NotiApi_CreateNotification(gp_VEOS_NotiApi_Instance, pNotificationFct, pNotificationName, pNotificationId);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_NotiApi_StartNotification
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: Starts the previously registered notification with the specified id.
 *** 
 *** PARAMETERS:
 ***     Type               Name                Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_uint32  NotificationId      Incoming argument: The notification Id.
 ***     const VEOS_uint64  NotificationOffset  Incoming argument: The relative notification offset in nanoseconds.
 ***     const VEOS_uint64  NotificationPeriod  Incoming argument: The notification period in nanoseconds.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
VEOS_ApiSuccessType VEOS_NotiApi_StartNotification(
    const VEOS_uint32 NotificationId,
    const VEOS_uint64 NotificationOffset,
    const VEOS_uint64 NotificationPeriod)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_NotiApi_StartNotification(gp_VEOS_NotiApi_Instance, NotificationId, NotificationOffset, NotificationPeriod);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_NotiApi_CancelNotification
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: Cancels the previously registered and started notification with the specified id.
 *** 
 *** PARAMETERS:
 ***     Type               Name            Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_uint32  NotificationId  Incoming argument: The notification Id.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
VEOS_ApiSuccessType VEOS_NotiApi_CancelNotification(const VEOS_uint32 NotificationId)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_NotiApi_CancelNotification(gp_VEOS_NotiApi_Instance, NotificationId);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif

/************************************************************************************************************************************************************************\
 *** Frame functions: Event handlers for simulation backplane events
\************************************************************************************************************************************************************************/

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_NotiApi_NotificationEvent
 *** 
 *** DESCRIPTION:
 ***     Frame function: This event occurs, when the simulator sends an asynchronous notification event.
 *** 
 *** PARAMETERS:
 ***     Type                                             Name              Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_SimApi_InterruptCallbackFunctionType  pNotificationFct  Incoming argument: The pointer to the notification function to call.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_NOTIAPI_NOTIFICATION == VEOS_ON
VEOS_ApiSuccessType VEOS_NotiApi_NotificationEvent(VEOS_SimApi_InterruptCallbackFunctionType const pNotificationFct)
{
    /* Result of current frame function. */
    VEOS_ApiSuccessType calloutResult = VEOS_E_NO_RESULT;

    /* Save frame function state. */
    VEOS_CALLOUT_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    /* Start of custom implementation from configuration file. */
    calloutResult = VEOS_SimApiImpl_InterruptEvent(pNotificationFct);
    /* End of custom implementation from configuration file. */

    /* Check result of frame function. */
    VEOS_CHECK_LOCAL_CALLOUT_RESULT(calloutResult);

    /* Save frame function state. */
    VEOS_CALLOUT_HANDLED(VEOS_API_NAME, __FUNCTION__, calloutResult);

    /* Return result to caller. */
    return calloutResult;
}
#endif


#endif /* VEOS_NOTIAPI_C */
/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  END OF FILE
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
