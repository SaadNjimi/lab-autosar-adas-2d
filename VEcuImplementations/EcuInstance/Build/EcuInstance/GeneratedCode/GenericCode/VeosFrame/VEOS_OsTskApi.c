/************************************************************************************************************************************************************************\
 *** VEOS_OsTskApi.c
 *** 
 *** Implementation of the VEOS Frame OsTaskHandlingApi.
 *** 
 *** File generated on 2022-02-16
 *** 
 *** Generated by VEOS Frame API generator
 *** 
 *** VEOS Frame build revision          : 5.4.0.1269
 *** VEOS Frame interaction ABI version : 5.4.0.0
 *** GeneratorVersion                   : 5.4.0.0
 *** GeneratorTimeStamp                 : 2022-02-16 10:07:28 (UTC)
 *** ABI OsTaskHandlingApi              : 5.0.0.0
 *** 
 *** Copyright (c) 2022 by dSPACE GmbH, Paderborn, Germany.
 *** All Rights Reserved.
\************************************************************************************************************************************************************************/

#ifndef VEOS_OSTSKAPI_C
#define VEOS_OSTSKAPI_C

/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  DEFINES (OPT)
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** Constant pre-processor defines for VEOS frame OsTaskHandlingApi
\************************************************************************************************************************************************************************/

#ifndef VEOS_OSTSKAPI_UNSETFUNCTIONPOINTER
/* The value if no pointer is set. */
#define VEOS_OSTSKAPI_UNSETFUNCTIONPOINTER 0
#endif

/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  INCLUDES
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

#include "VEOS.h"
#include "VEOS_Private.h"
#include "VEOS_Callbacks.h"


/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  DEFINES
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** Pre-processor defines for API OsTskApi to take care of.
\************************************************************************************************************************************************************************/

#ifndef VEOS_OSTSKAPI_TASKHANDLING_CFG_VALUE
/* VEOS_OSTSKAPI_TASKHANDLING_CFG_VALUE must be defined for a proper functionality of this API. */
#error Required definition of 'VEOS_OSTSKAPI_TASKHANDLING_CFG_VALUE' not found. The configuration is invalid.
#endif

/************************************************************************************************************************************************************************\
 *** Constant pre-processor defines for VEOS frame OsTaskHandlingApi
\************************************************************************************************************************************************************************/

#ifndef VEOS_OSTSKAPI_TASKHANDLING
/* Configuration value indicating, whether task handling is enabled or not. */
#define VEOS_OSTSKAPI_TASKHANDLING VEOS_OSTSKAPI_TASKHANDLING_CFG_VALUE
#endif

/* The API name. */
#ifdef VEOS_API_NAME
#undef VEOS_API_NAME
#endif
#define VEOS_API_NAME "OsTaskHandlingApi"

/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  VARIABLE DEFINITIONS
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** Directly transferred global variables for VEOS frame OsTaskHandlingApi
\************************************************************************************************************************************************************************/
/* Pointer to the OsTskApi instance. */
void * gp_VEOS_OsTskApi_Instance;


/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  FUNCTION DEFINITIONS
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/************************************************************************************************************************************************************************\
 *** State management functions for the VEOS frame OsTaskHandlingApi
\************************************************************************************************************************************************************************/

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_OsTskApi_Start
 *** 
 *** DESCRIPTION:
 ***     Performs a start-up on the VEOS Frame OsTskApi part.
 *** 
 *** PARAMETERS:
 ***     -/-
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
VEOS_ApiSuccessType VEOS_OsTskApi_Start(void)
{
    VEOS_ApiSuccessType result = VEOS_E_OK;

    /* Check if API is correctly connected to the VpuHost */
    #if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
    if (VEOS_OSTSKAPI_UNSETFUNCTIONPOINTER == gp_VEOS_OsTskApi_CreateThread)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    #if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
    if (VEOS_OSTSKAPI_UNSETFUNCTIONPOINTER == gp_VEOS_OsTskApi_DeleteThread)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    #if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
    if (VEOS_OSTSKAPI_UNSETFUNCTIONPOINTER == gp_VEOS_OsTskApi_SwitchToThread)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    #if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
    if (VEOS_OSTSKAPI_UNSETFUNCTIONPOINTER == gp_VEOS_OsTskApi_GetCurrentThreadId)
    {
        result = VEOS_E_API_DISCONNECTED;
    }
    else
    #endif
    result = VEOS_E_OK;

    /* Nothing more to do. */
    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, result);

    return result;
}

/************************************************************************************************************************************************************************\
 *** Host function wrappers: Callbacks to simulator backplane
\************************************************************************************************************************************************************************/

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_OsTskApi_CreateThread
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: This function creates a thread including the stacks of a new OS task.
 *** 
 *** PARAMETERS:
 ***     Type                                  Name       Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_char *                     pTaskName  Incoming argument: The name of the task that should be created.
 ***     const VEOS_uint32                     StackSize  Incoming argument: The size of the stack.
 ***     const VEOS_OsTskApi_TaskFunctionType  pTaskFct   Incoming argument: The pointer to the function to call.
 ***     VEOS_OsTskApi_TaskIdType *            TaskId     Outgoing argument: The ID of the task that is created.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
VEOS_ApiSuccessType VEOS_OsTskApi_CreateThread(
    const VEOS_char * pTaskName,
    const VEOS_uint32 StackSize,
    VEOS_OsTskApi_TaskFunctionType const pTaskFct,
    VEOS_OsTskApi_TaskIdType * TaskId)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    #ifndef VEOS_NOCHECKS
    /* Check pTaskFct to be a valid pointer. */
    VEOS_CHECK_PARAM_PTR(pTaskFct);
    /* Check TaskId to be a valid pointer. */
    VEOS_CHECK_PARAM_PTR(TaskId);
    #endif

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_OsTskApi_CreateThread(gp_VEOS_OsTskApi_Instance, pTaskName, StackSize, pTaskFct, TaskId);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_OsTskApi_DeleteThread
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: This function deletes the thread specified by the task ID.
 *** 
 *** PARAMETERS:
 ***     Type                            Name    Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_OsTskApi_TaskIdType  TaskId  Incoming argument: The ID of the task that should be deleted.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
VEOS_ApiSuccessType VEOS_OsTskApi_DeleteThread(const VEOS_OsTskApi_TaskIdType TaskId)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_OsTskApi_DeleteThread(gp_VEOS_OsTskApi_Instance, TaskId);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_OsTskApi_SwitchToThread
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: This function switches to the thread specified by the task ID.
 *** 
 *** PARAMETERS:
 ***     Type                            Name    Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     const VEOS_OsTskApi_TaskIdType  TaskId  Incoming argument: The ID of the task that should be switched to.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
VEOS_ApiSuccessType VEOS_OsTskApi_SwitchToThread(const VEOS_OsTskApi_TaskIdType TaskId)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_OsTskApi_SwitchToThread(gp_VEOS_OsTskApi_Instance, TaskId);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif

/************************************************************************************************************************************************************************\
 *** FUNCTION:
 ***     VEOS_OsTskApi_GetCurrentThreadId
 *** 
 *** DESCRIPTION:
 ***     Host function wrapper: This function returns the ID of the current thread.
 *** 
 *** PARAMETERS:
 ***     Type                        Name    Description
 ***     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***     VEOS_OsTskApi_TaskIdType *  TaskId  Outgoing argument: The ID of the current thread.
 *** 
 *** RETURNS:
 ***     VEOS_ApiSuccessType    If no error occurs, VEOS_E_OK will be returned. If any error occurs, an error code will be the result. See VEOS_Types.h for details.
\************************************************************************************************************************************************************************/
#if VEOS_OSTSKAPI_TASKHANDLING == VEOS_ON
VEOS_ApiSuccessType VEOS_OsTskApi_GetCurrentThreadId(VEOS_OsTskApi_TaskIdType * TaskId)
{
    /* Result of current host function */
    VEOS_ApiSuccessType callbackResult = VEOS_E_NO_RESULT;

    /* Track method start to debugging API */
    VEOS_FRM_DBG_METHOD_START(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_UNHANDLED(VEOS_API_NAME, __FUNCTION__);

    #ifndef VEOS_NOCHECKS
    /* Check TaskId to be a valid pointer. */
    VEOS_CHECK_PARAM_PTR(TaskId);
    #endif

    /* Reset result of host function to make sure simulation backplane is the one to modify the result code. */
    callbackResult = VEOS_E_OK;

    /* Invoke host function and perform callback to simulator. */
    callbackResult = gp_VEOS_OsTskApi_GetCurrentThreadId(gp_VEOS_OsTskApi_Instance, TaskId);

    /* Check result of host function. */
    VEOS_CHECK_LOCAL_CALLBACK_RESULT(callbackResult);

    /* Track method end to debugging API */
    VEOS_FRM_DBG_METHOD_END(VEOS_API_NAME, __FUNCTION__);

    /* Save host function state. */
    VEOS_CALLBACK_HANDLED(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Track method result to debugging API */
    VEOS_FRM_DBG_METHOD_RESULT(VEOS_API_NAME, __FUNCTION__, callbackResult);

    /* Return result to caller. */
    return callbackResult;
}
#endif


#endif /* VEOS_OSTSKAPI_C */
/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*\
  END OF FILE
\*----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
